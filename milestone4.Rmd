---
title: "Milestone 4 and 5"
author: "Sandya Krishna, Mai Sedki, Lourdes Valdez"
date: "11/30/2020"
output:
  html_document:
    df_print: paged
---

# Research questions / Problem statement:
Infectious diseases are a very important public health issue. So we want to 
examine overall communicable disease rates and trends over time of Infectious diseases reported in california. Sexually transmitted diseases will be analized separately from other groups of infectious diseases.

# Datasets to be used :
1. Infectious Diseases by County, Year and Sex (in California)2001-2018
   Source : https://data.chhs.ca.gov/dataset/infectious-disease
   Raw format of dataset:
  https://data.chhs.ca.gov/dataset/03e61434-7db8-4a53-a3e2-1d4d36d6848d/resource
  /75019f89-b349-4d5e-825d-8b5960fc028c/download/idb_odp_2001-2018.csv
  Name/source: CHHS Open Data
  Number of columns: 10
  Number of rows: 154,344
2.STD's in California by disease, vounty, year and sex. Dtasethas  case counts
  and rates for sexually transmitted diseases (chlamydia, gonorrhea, and all
  forms of syphilis) reported for California residents.
  https://data.chhs.ca.gov/dataset/stds-in-california-by-disease-county-year-and
  -sex
  
```{r setup, include=F}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#Loading libraries:
library(tidyverse)
library(readr)
library(knitr)
library(kableExtra)
library(plotly)
library(ggplot2)
```


```{r, include =FALSE}
#Calling the dataset and naming dataframe id_data:
id_data <- read.csv("idb_odp_2001-2018 (1) (1).csv")
```


```{r, echo=FALSE}
# Now will look at the dataframe from the environment plus the first five rows
# using the head function. Noticed the following:
#The "rate" column has a lot of "dashes" or missing values because of 0 cases for 
#some diseases. Will look at all the values to see using the function unique()
#unique(id_data$rate), and other than a dash, we see empty cells and "SC"
# Will now clean the data by eliminating empty values ," ", "-" or NA 
# For correcting the NA values I will have to correct at the top of this code
# when I call the dataframe. I will do that now by adding to the code: 
#na = (c(" ","-","SC","NA"))
```
```{r include=FALSE}
id_data <- read_csv("idb_odp_2001-2018 (1) (1).csv", na = (c(" ","-","SC","NA")))
```
```{r, include=FALSE}
# Change the column names to be more r friendly,using the function rename  column names will changeto all lower case and snake_case.
id_data <- rename_with(id_data, ~ tolower(gsub(" ","_",.x,fixed=TRUE)))
```
```{r, include =FALSE}
head(id_data)
```


```{r, include=FALSE}
# next We would like to do the following changes
# to the rate column: change it to numeric, round it to 2 decimal values and d/c 
# the asterisk "*" 
id_data$rate <- as.numeric(as.character(id_data$rate))
# I view the table and run str() and now rate is numeric and asterisk is gone.
# Now will round to 2 decimals, will also round the CI to 2 decimals
id_data$rate <- round(id_data$rate,2)
id_data$`lower_95%_ci` <- round(id_data$`lower_95%_ci`, 2)
id_data$`upper_95%_ci` <- round(id_data$`upper_95%_ci`,2)

```


\newpage
# Creating variables for data analysis:
*We created new groups of variables to facilitate data presentation and analysis.
The new groups of variables are:  
Name of california region, for the 10 different California regions  
Type of infectious disease : to group each of thereported diseases by "type of disease" , following conventional microbiology classification.

The California regions are as follows:
Superior <- "NEVADA","PLACER","PLUMAS","SACRAMENTO","SHASTA","SIERRA",
"SISKIYOU","SUTTER","TEHAMA", "YOLO", "YUBA", "MODOC", "EL DORADO", "BUTTE",
"GLENN", "LASSEN"
North Coast <- "DEL NORTE", "HUMBOLDT", "LAKE", "MENDOCINO", "NAPA","SONOMA",
"TRINITY"
Bay area<- "ALAMEDA","CONTRA COSTA", "MARIN", "SAN FRANCISCO", "SAN MATEO", 
             "SANTA CLARA", "SOLANO"
North San Joaquin Valley <- "ALPINE", "AMADOR", "CALAVERAS", "MADERA", "MARIPOSA",
"MERCED", "MONO","SAN JOAQUIN", "STANISLAUS", "TUOLUMNE" 
Central Coast <- "MONTEREY", "SAN BENITO", "SAN LUIS OBISPO", "SANTA BARBARA",
             "SANTA CRUZ", "VENTURA"
South San Joaquin Valley <- "FRESNO","INYO", "KERN", "KINGS", "TULARE"
Inland Empire<- "RIVERSIDE", "SAN BERNARDINO"
LA County <- "LOS ANGELES"
Orange County <- "ORANGE"
San Diego and Imperial County <- "IMPERIAL", "SAN DIEGO"
We will also have california as a total.

The groups of infectious diseases will be as follows:
1. Parasitic <- c("Amebiasis","Babesiosis", "Cryptosporidiosis", "Cyclosporiasis",
"Cysticercosis or Taeniasis", "Malaria", "Giardiasis", "Trichinosis")
2. Toxin_related <- c("Botulism, Foodborne","Botulism, Other", "Botulism, Wound",
"Ciguatera Fish Poisoning", "Domoic Acid Poisoning","Paralytic Shellfish
Poisoning", "Scombroid Fish Poisoning") 
3. viral <- c("Chikungunya Virus Infection", "Dengue Virus Infection","Flavivirus
Infection of Undetermined Species","Hantavirus Infection","Hepatitis E acute
infection","Rabies, human","Yellow Fever", "Zika Virus Infection") 
prions <- c("Creutzfeldt-Jakob Disease and other Transmissible Spongiform
Encephalopathies")
4. fungal <- c("Coccidioidomycosis")
5. Bacterial <- c("Anaplasmosis", "Anaplasmosis and Ehrlichiosis", "Anthrax",
"Brucellosis", "Campylobacteriosis","Cholera","E. coli O157","E. coli Other STEC
(non-O157)", "Legionellosis","Leprosy (Hansen's Disease)", "Leptospirosis",
"Listeriosis", "Lyme Disease","Plague, human","Q Fever","Spotted Fever
Rickettsiosis", "Streptococcal Infection (cases in food and dairy workers)",
"Ehrlichiosis", "Psittacosis", "Salmonellosis", "Shigellosis", "Tularemia",
"Typhoid Fever", "Paratyphoid Fever", "Typhus Fever", "Relapsing Fever", "Shiga
toxin-producing E. coli (STEC) without Hemolytic Uremic Syndrome (HUS)",
"Vibrio Infection (non-Cholera)", "Shiga Toxin Positive Feces (without culture
confirmation)","Yersiniosis")
6. Infectious_complications <- c("Hemolytic Uremic Syndrome (HUS) without evidence
of Shiga toxin-producing E. coli (STEC)","Hemolytic Uremic Syndrome (HUS)", 
"Shiga toxin-producing E. coli (STEC) with Hemolytic Uremic Syndrome (HUS)")
```{r include=F}
#Creating the first variable "region"
#We will group the counties that correspond to the California regions, as done
#by the Census bureau: For census purposes, California is divided in 10 
#regions https://census.ca.gov/regions/
#First I will use  function unique() to see all the values

#Next  will create vectors with function c() to group into the appropiate region
#looking carefully on how counties are spelled
region1 <- c("NEVADA","PLACER","PLUMAS","SACRAMENTO","SHASTA","SIERRA",
"SISKIYOU","SUTTER","TEHAMA", "YOLO", "YUBA", "MODOC", "EL DORADO", "BUTTE",
"GLENN", "LASSEN")
region2 <- c("DEL NORTE", "HUMBOLDT", "LAKE", "MENDOCINO", "NAPA","SONOMA",
"TRINITY")
region3 <- c("ALAMEDA","CONTRA COSTA", "MARIN", "SAN FRANCISCO", "SAN MATEO", 
             "SANTA CLARA", "SOLANO")
region4 <- c("ALPINE", "AMADOR", "CALAVERAS", "MADERA", "MARIPOSA",
"MERCED", "MONO","SAN JOAQUIN", "STANISLAUS", "TUOLUMNE") 
region5 <- c("MONTEREY", "SAN BENITO", "SAN LUIS OBISPO", "SANTA BARBARA",
             "SANTA CRUZ", "VENTURA")
region6 <- c("FRESNO","INYO", "KERN", "KINGS", "TULARE")
region7 <- c("RIVERSIDE", "SAN BERNARDINO")
region8 <- c("LOS ANGELES")
region9 <- c("ORANGE")
region10 <- c("IMPERIAL", "SAN DIEGO")
California <- c("CALIFORNIA")

```
```{r, include=F}
#Now will create new column using function mutate and add to current table,
I #noticed aside for counties there is a "CALIFORNIA" value, will add that
IDtable1 <- id_data %>% mutate(region = case_when(
  county %in% region1 ~ "Superior",
  county %in% region2 ~ "N_coast",
  county %in% region3 ~ "Bay_area",
  county %in% region4 ~ "NSJ_valley",
  county %in% region5 ~ "C_coast",
  county %in% region6 ~ "SSJ_valley",
  county %in% region7 ~ "I_Empire",
  county %in% region8 ~ "LA_county",
  county %in% region9 ~ "O_county",
  county %in% region10 ~ "SDI_county",
  county %in% California ~ "California",
  TRUE ~ NA_character_
)) %>%
  drop_na(region)

#it worked new column formed  called "group" on ID_table1
```
```{r, include = FALSE}
# Creating the second variable "ID_type"
# Our group decided to create the seven following groups:
parasitic <- c("Amebiasis","Babesiosis", "Cryptosporidiosis", "Cyclosporiasis",
"Cysticercosis or Taeniasis", "Malaria", "Giardiasis", "Trichinosis")
toxin_related <- c("Botulism, Foodborne","Botulism, Other", "Botulism, Wound",
"Ciguatera Fish Poisoning", "Domoic Acid Poisoning","Paralytic Shellfish
Poisoning", "Scombroid Fish Poisoning") 
viral <- c("Chikungunya Virus Infection", "Dengue Virus Infection","Flavivirus
Infection of Undetermined Species","Hantavirus Infection","Hepatitis E acute
infection","Rabies, human","Yellow Fever", "Zika Virus Infection") 
prions <- c("Creutzfeldt-Jakob Disease and other Transmissible Spongiform
Encephalopathies")
fungal <- c("Coccidioidomycosis")
bacterial <- c("Anaplasmosis", "Anaplasmosis and Ehrlichiosis", "Anthrax",
"Brucellosis", "Campylobacteriosis","Cholera","E. coli O157","E. coli Other STEC
(non-O157)", "Legionellosis","Leprosy (Hansen's Disease)", "Leptospirosis",
"Listeriosis", "Lyme Disease","Plague, human","Q Fever","Spotted Fever
Rickettsiosis", "Streptococcal Infection (cases in food and dairy workers)",
"Ehrlichiosis", "Psittacosis", "Salmonellosis", "Shigellosis", "Tularemia",
"Typhoid Fever", "Paratyphoid Fever", "Typhus Fever", "Relapsing Fever", "Shiga
toxin-producing E. coli (STEC) without Hemolytic Uremic Syndrome (HUS)",
"Vibrio Infection (non-Cholera)", "Shiga Toxin Positive Feces (without culture
confirmation)","Yersiniosis")
infectious_complications <- c("Hemolytic Uremic Syndrome (HUS) without evidence
of Shiga toxin-producing E. coli (STEC)","Hemolytic Uremic Syndrome (HUS)", 
"Shiga toxin-producing E. coli (STEC) with Hemolytic Uremic Syndrome (HUS)")

# now I will create a new table naming it IDtable2 with new column ID_type
IDtable2 <- IDtable1 %>% mutate(ID_type = case_when(
  disease %in% parasitic ~ "Parasitic",
  disease %in% toxin_related ~ "Toxin_related",
  disease %in% viral ~ "Viral",
  disease %in% prions ~ "Prions",
  disease %in% fungal ~ "Fungal",
  disease %in% bacterial ~ "Bacterial",
  disease %in% infectious_complications ~ "ID_complication",
  TRUE ~ NA_character_
)) %>%
  drop_na(ID_type)

```
```{r,include=F}
#Create ID_tableyears_grouptotal . Grouping every 3 years as a single period and change years to character, keep only total instead of male and female.
ID_tableyears_group_total <- IDtable2 %>%
  mutate(time_period =case_when(
    year %in% c(2001,2002,2003)~ "2001-2003",
    year %in% c(2004,2005,2006)~ "2004-2006",
    year %in% c(2007,2008,2009)~ "2007-2009",
    year %in% c(2010,2011,2012)~ "2010-2012",
    year %in% c(2013,2014,2015)~ "2013-2015",
    year %in% c(2016,2017,2018)~ "2016-2018",
     )) %>%
  filter(sex=="TOTAL")

```
```{r , include=FALSE}

populationv <-c(34512742, 34938290, 35388928, 35752765, 35985582, 36246822, 36552529, 36856222, 37077204, 37334578, 37678534, 38045271, 38425695, 38756940, 39076128,39328337, 39610556,39825181,34512742, 34938290, 35388928, 35752765, 35985582, 36246822, 36552529, 36856222, 37077204, 37334578, 37678534, 38045271, 38425695, 38756940, 39076128,39328337, 39610556,39825181, 34512742, 34938290, 35388928, 35752765, 35985582, 36246822, 36552529, 36856222, 37077204, 37334578, 37678534, 38045271, 38425695, 38756940, 39076128,39328337, 39610556,39825181,34512742, 34938290, 35388928, 35752765, 35985582, 36246822, 36552529, 36856222, 37077204, 37334578, 37678534, 38045271, 38425695, 38756940, 39076128,39328337, 39610556,39825181)


ID_table3californiaonly <- IDtable2 %>%
    filter(sex=="TOTAL", county=="CALIFORNIA")%>%
 filter(ID_type=="Bacterial"|ID_type== "Parasitic"|ID_type=="Fungal"|ID_type=="Viral")%>%
 group_by(ID_type,year)%>%
    summarize(sum_cases=sum(cases))%>%
  cbind(populationv)%>%
  rename(pop_total="...4")%>%
 mutate(rate_total= (sum_cases/pop_total)*100000)

#ID_table3californiaonly <- rep_len(populationv,length.out = 72)
```

```{r}
ID_table3californiaonlyB <- IDtable2 %>%
    filter(sex=="TOTAL",county=="CALIFORNIA",ID_type=="Bacterial"|ID_type== "Parasitic"|ID_type=="Fungal"|ID_type=="Viral")%>%
 group_by(ID_type,year)%>%
 summarize(sum_cases=sum(cases), 
           rate=sum_cases/population)
 # cbind(populationv)%>%
 # rename(pop_total="...4")%>%
 #mutate(rate_total= (sum_cases/population)*100000) 
```

\newpage
# Tables
```{r, include=False}
my_table_data <- ID_tableyears_group_total %>%
  select(c("ID_type","region","rate","time_period")) %>%
  filter(ID_type=="Bacterial"|ID_type== "Parasitic"|ID_type=="Fungal"|ID_type=="Viral") %>%
  filter(region=="California")%>%
  drop_na(rate) %>%
  group_by(ID_type,time_period,region) %>%
  summarise(cumm_rate = sum (rate))
```


```{r, include=False}
my_new_table_data <- my_table_data %>%
  pivot_wider(names_from=c(ID_type),values_from= "cumm_rate")
```


```{r}
kable(my_new_table_data, 
      booktabs=T, 
      col.names=c("Time Period", " ","Bacterial", "Fungal", "Parasitic", "Viral"),  
      align='lccc', 
      caption="Infectious disease rates (Cases/100,000) over time by disease etiology (from 2001 - 2018 by 3 year increments)",
      format.args=list(big.mark=","))
```
 

```{r, include=False}
##Mai
my_bayarea_table <- ID_tableyears_group_total %>%
  select(c("ID_type","region","rate","time_period")) %>%
  filter(ID_type=="Bacterial"|ID_type== "Parasitic"|ID_type=="Fungal"|ID_type=="Viral") %>%
  filter(region=="Bay_area") %>%
  drop_na(rate) %>%
 #group_by(ID_type, time_period)%>%
  group_by(ID_type,time_period,region) %>%
  summarise(cumm_rate = sum (rate))

```
```{r, include=False}

my_new_bayarea_table <- my_bayarea_table %>%
  pivot_wider(names_from=c(ID_type),values_from= "cumm_rate")

```

\newpage

```{r}
# Table for  bay area only :
kable(my_new_bayarea_table, 
      booktabs=T, 
      col.names=c("Time_Period", " ", "Bacterial", "Fungal", "Parasitic", "Viral"),
      align='lccc', 
      caption="Infectious disease rates over time in the Bay Area from 2001-2018 by etiology of 
     disease and time period (3 year cummulatives)",
      format.args=list(big.mark=","))



```

# Figures


\newpage
#Figures:

```{r, eval=F}
# Lourdes. Create a table showing trends of group of diseases by time_period  in California. From all groups of diseases
# Creating table for graph:
ID_tableyears_group_total_fig1L <- ID_tableyears_group_total %>%
 filter(ID_type=="Bacterial"|ID_type=="Parasitic"|ID_type=="Fungal"|ID_type=="Viral")%>%
  select(c("ID_type","region","rate","time_period")) %>%
         filter(region=="California")%>%
  drop_na(rate) %>%
  group_by(ID_type,time_period,region) %>%
  #summarise(cumm_rate = sum (rate))

ggplot(ID_tableyears_group_total_fig1L, aes(x = ID_type, y = cumm_rate)) +
geom_bar(aes(fill=time_period), stat="identity", position = position_dodge()) +
#geom_col(aes(fill=), col)
  scale_y_continuous(labels = function(x) format(x,bigmark=",",scientific=FALSE))+
  #scale_fill_manual(name= "time_period") +
  scale_fill_discrete(name= "time_period")+
  #                  ,
  #values=c("#ffd333","#ff6600","#be0f24","#f91cc7","#910ff5","#003884")) +
labs(x="Group of Infectious disease", y = "Cummulative rate",
title = "Figure 1: Trend of infectious diseases over time from 2001-2018 by type of 
     Disease and time period (3 year averages)")

``` 
Figure 1 shows that of the reported infectious diseases (excluding sexually transmitted diseases) that are most commonly reported are Bacterial diseases, followed by Fungal, and then parasitic diseases. Viral diseases have a lower 
rate. These numbers do not necessarily translates into real prevalence since 
many diseases are not considered "reportable", due to their common prevalence and ubiquitous distribution.

\newpage
```{r}
#Figure 2L Trends from 2001-2018 only for Bacterial, Fungal and Parasitic conditions
ID_tableyears_group_total_fig2L <- ID_tableyears_group_total %>%
  select(c("ID_type","region","rate","year")) %>%
  mutate(year=as.character(year)) %>%
         filter(region=="California")%>%
  filter(ID_type=="Bacterial"|ID_type== "Parasitic"|ID_type=="Fungal"|ID_type=="Viral") %>%
    drop_na(rate) %>%
  group_by(ID_type,year,region) %>%
  summarise(cumm_rate = sum (rate)) 
#Figure 2 corrected
Figure2L_table <- ID_table3californiaonly


#using plotly
plot_ly(
  ID_tableyears_group_total_fig2L,
  x= ~year,
  y= ~cumm_rate,
  color= ~ID_type,
  type="bar"
) %>%
  layout(barmode="stack")%>%
  
  layout(
    title = "Figure 2 : Trends of Bacterial Fungal and Parasitic Diseases
    rates per 100,000 from 2001-2018 in California
    (Excludes STD's)",
    xaxis = list(title = "Years"),
    yaxis = list(title = "California Rates per 100,000")
  )

```
Figure 2: We could tell thet through the years, reports of bacterial diseases have increased overtime. Reasons for this increase could be related to a real increase of reportable cases, versus improved report methodology. The same goes to Fungal infections. Parasitic infections have ranged from  4.6/100,000 in 2002 to 19.33/100,000 in 2017.

\newpage
```{r}
#Lourdes most common bacterial diseases from 2001 to 2018:
ID_mostcommon_bacterial_fig3L <- IDtable2 %>%
  #select(c("disease","ID_type","region","rate","year","sex","cases","population")) %>%
  mutate(year=as.character(year)) %>%
         filter(region=="California")%>%
  filter(sex=="TOTAL") %>%
  filter(ID_type=="Bacterial") %>%
      drop_na(rate) %>%
 group_by(disease) %>%
  summarise(cumm_rate = sum (rate)) %>%
  #summarize(cum_disease = sum(disease)) %>%
#mutate(average_cases= (cum_disease/18))
filter(cumm_rate >= 5)
#using plotly
plot_ly(
  ID_mostcommon_bacterial_fig3L,
  x= ~disease,
  y= ~cumm_rate,
  color= ~disease,
  type="bar") %>%
# layout(barmode="stack")%>%
  
  layout(
    title = "Most common reported Bacterial Infection
     aprox cummulative rates per 100,000 from 2001-2018 in California
    (Excludes STD's)",
    xaxis = list(title = "Bacterial Infections"),
    yaxis = list(title = "California Rates per 100,000")
  )
```
\newpage
```{r}
#Lourdes; will create a new bar chart for most common reported Parasitic diseases rates i California
ID_mostcommon_parasitic_fig4L <- IDtable2 %>%
  select(c("disease","ID_type","region","rate","year" ))%>%
  mutate(year=as.character(year)) %>%
         filter(region=="California")%>%
  filter(ID_type=="Parasitic") %>%
  #filter(year=="2018")
    drop_na(rate) %>%
 # group_by(disease,year) %>%
  group_by(disease) %>%
  summarise(cumm_rate = sum (rate)) %>%
  filter(cumm_rate >= 1)
#using plotly
plot_ly(
  ID_mostcommon_parasitic_fig4L,
  x= ~disease,
  y= ~cumm_rate,
  color= ~disease,
  type="bar") %>%
# layout(barmode="stack")%>%
  
  layout(
    title = "Most common reported Parasitic Diseases
    rates per 100,000 from 2001-2018 in California",
    xaxis = list(title = "Parasitic Infections"),
    yaxis = list(title = "California Rates per 100,000")
  )
```
<<<<<<< HEAD

```{r, include =FALSE}
=======
```{r, eval =FALSE}
>>>>>>> 6daff035f3f3715e96e627d33832cbf6beb6cba5
#Lourdes; will create a new bar chart for most common reported fungal diseases rates in California
ID_mostcommon_fungal_fig5L <- IDtable2 %>%
  select(c("disease","ID_type","region","rate","year")) %>%
  mutate(year=as.character(year)) %>%
         filter(region=="California")%>%
  filter(ID_type=="Fungal") %>%
  #filter(year=="2018")
   # drop_na(rate) %>%
 # group_by(disease,year) %>%
  group_by(disease) %>%
  #summarise(cumm_rate = sum (rate))%>%
  #mutate(average_rate <- by(IDtable3))
 filter(cumm_rate >= 0.0001)
#using plotly
plot_ly(
  ID_mostcommon_fungal_fig5L,
  x= ~disease,
  y= ~cumm_rate,
  color= ~disease,
  type="bar")%>%
# layout(barmode="stack")%>%
  
  layout(
    title = "Most common reported Fungal Infections
    rates per 100,000 from 2001-2018 in California
    (Excludes STD's)",
    xaxis = list(title = "Fungal infections"),
    yaxis = list(title = "California Rates per 100,000")
  )
```

\newpage
```{r}
#Lourdes; will create a new bar chart for most common reported viral diseases rates i California
ID_mostcommon_viral_fig6L <- IDtable2 %>%
  select(c("disease","ID_type","region","rate","year")) %>%
  mutate(year=as.character(year)) %>%
         filter(region=="California")%>%
  filter(ID_type=="Viral") %>%
  #filter(year=="2018")
    drop_na(rate) %>%
 # group_by(disease,year) %>%
  group_by(disease) %>%
  summarise(cumm_rate = sum (rate)) %>%
  filter(cumm_rate > 0.05)
#using plotly
plot_ly(
  ID_mostcommon_viral_fig6L,
  x= ~disease,
  y= ~cumm_rate,
  color= ~disease,
  type="bar")%>%
# layout(barmode="stack")%>%
  
  layout(
    title = "Most common reported Viral Infections
    rates per 100,000 from 2001-2018 in California
    (Excludes STD's)",
    xaxis = list(title = "Viral infections"),
    yaxis = list(title = "California Rates per 100,000")
  )
```



\newpage

#Line Graphs:

```{r, include=False}

#sandya-create disease trend over time

individualdata1<- read_csv("stds-by-disease-county-year-sex.csv")
groupdata<-read_csv("idb_odp_2001-2018 (1) (1).csv")

groupdatafinal<-filter(groupdata, County %in% c("ALAMEDA", "SANTA CLARA", "SAN MATEO", "SAN FRANCISCO", "MARIN", "CONTRA COSTA", "SOLANO"))


  
individualdatafinal<-filter(individualdata1, County %in% c("Alameda", "Santa Clara", "San Mateo", "San Francisco", "Marin", "Contra Costa", "Solano"))%>% select(-10)


combineddata<-rbind(groupdatafinal, individualdatafinal)

combineddata$County<-tolower(combineddata$County)
combineddata$Sex<-tolower(combineddata$Sex)

combineddata1<-combineddata%>%filter(Sex %in% "total")

combinedatafinal<-combineddata1%>%mutate(Disease_Type = case_when(Disease %in% c("Gonorrhea", "Early Syphilis", "Chlamydia")~ "STD (Bacterial)", Disease %in% c("Shiga toxin-producing E. coli (STEC) with Hemolytic Uremic Syndrome (HUS)", "Shiga toxin-producing E. coli (STEC) without Hemolytic Uremic Syndrome (HUS)", "Anaplasmosis and Ehrlichiosis", "Hemolytic Uremic Syndrome (HUS) without evidence of Shiga toxin-producing E. coli (STEC)", "Paratyphoid Fever", "Ehrlichiosis", "Anaplasmosis" ,"Shiga Toxin Positive Feces (without culture confirmation)", "E. coli Other STEC (non-O157)",  "Yersiniosis"  ,"Vibrio Infection (non-Cholera)" , "Typhoid Fever", "Typhus Fever",  "Tularemia"  ,"Streptococcal Infection (cases in food and dairy workers)"  ,"Spotted Fever Rickettsiosis" , "Shigellosis","Salmonellosis", "Relapsing Fever" , "Q Fever" , "Psittacosis" , "Plague, human","Lyme Disease", "Listeriosis"  ,"Leptospirosis","Leprosy (Hansen's Disease)" ,"Legionellosis","E. coli O157" ,"Cholera"  , "Campylobacteriosis"  ,"Brucellosis" , "Anthrax" )~ "Bacteria", Disease %in% c("Chikungunya Virus Infection", "Dengue Virus Infection","Flavivirus Infection of Undetermined Species", "Hantavirus Infection","Hepatitis E, acute infection", "acute infection", "Rabies, human","Yellow Fever", "Zika Virus Infection")~ "Virus", Disease %in% c("Amebiasis","Babesiosis", "Cryptosporidiosis", "Cyclosporiasis", "Cysticercosis or Taeniasis", "Malaria", "Giardiasis", "Trichinosis")~"Protozoa", Disease %in% c( 'Botulism, Foodborne', 'Botulism, Other', 'Botulism, Wound', 'Ciguatera Fish Poisoning', 'Domoic Acid Poisoning',  'Paralytic Shellfish Poisoning', 'Scombroid Fish Poisoning')~ "Toxin", Disease %in% c('Creutzfeldt-Jakob Disease and other Transmissible Spongiform Encephalopathies')~ "Prion", Disease ==  'Hemolytic Uremic Syndrome (HUS)'~ "Infectious Complication", Disease == "Coccidioidomycosis"~ "Fungal"))

```
```{r, include=False}
data1<-combinedatafinal%>%select(-9)

data1$Rate<-(data1$Cases/data1$Population)*100000

plotdatatest<-data1%>%group_by(Disease_Type, Year)%>%summarize(Sum_cases=sum(Cases))


testin<-data1%>%group_by(County, Year)%>%summarize(total_pop=mean(Population))%>%group_by(Year)%>%summarise(totalp=sum(total_pop))

hope<-left_join(testin, plotdatatest, by= "Year")
hope$Overall_Rate<-(hope$Sum_cases/hope$totalp)*100000


```

```{r}
ggplot(hope, aes(x=Year, y=Overall_Rate))+facet_wrap(vars(Disease_Type), ncol = 2)+geom_line(aes(color = Disease_Type))+labs(x="Year", y="Overall Rate (per 100K)", title = "Overall Rates of Infectious diseases (including STDs) in Bay Area Counties from 2001-2018") + theme_minimal()
```

Interpretation of graph: This graph looks at the overall rates per year of different types of infectious disease in the Bay area counties from 2001 to 2018, without an adjusted Y axis. I created this graph to show how much of a significant difference rates of STDs are compared to other disease types. From the graphs it is noticeable that STD rates are increasing at a much greater level than other types of infectious diseases. 
\newpage
```{r}
ggplot(hope, aes(x=Year, y=Overall_Rate))+facet_wrap(vars(Disease_Type), ncol = 2, scales = "free_y")+geom_line(aes(color = Disease_Type))+labs(x="Year", y="Overall Rate (per 100K)", title = "Overall Rates of Infectious diseases (including STDs) in Bay Area Counties from 2001-2018") + theme_minimal()
```
Interpretation of graph: This graph looks at the overall rates per year of different types of infectious disease from 2001 to 2018 in the Bay area counties, with the Y axis adjusted. I created this graph to better visualize the trends in diseases apart from STDs. From the graphs it is noticeable that fungal and bacterial rates are increasing overtime, along with STD rates. 

\newpage
```{r, include=False}
combineddatagender<-individualdatafinal%>%filter(Sex %in% c("Male", "Female"))%>%select(-9)%>%group_by(Sex, Year)%>%summarise(case_total=sum(Cases))
 
std_set<-left_join(testin, combineddatagender, by= "Year")
std_set$Overall_Rate<-(std_set$case_total/std_set$totalp)*100000

```

```{r}
ggplot(std_set, aes(x=Year, y=Overall_Rate))+geom_line(aes(color = Sex))+labs(x="Year", y="Overall Rate (per 100K)", title = "Overall rates per year of STDs (Bacterial) in Bay Area Counties from 2001-2018 seperated by Sex") +theme_minimal()


```
Interpretation of graph: This graph looks at the Overall rates per year of bacterial STD infectious disease in the Bay area counties from 2001 to 2018, seperated by Sex. I created this graph to better visualize the trends in STDs between males and females.The graphs shows a very significant increase in the overall rate of STDs for both male and females. Prior to around 2014, it seems that female rates were higher than male rates. However from around 2014 and onward, we see an even greater increase in male rates.


